#+TITLE: Northwestern Utilities and Hardware Abstraction Layer (nuhal)
* Introduction
An assortment of C utilities and hardware abstractions that work on multiple platforms including x86 PC's and microcontrollers.  
One day this library could be more generically useful, but currently it is developed according to the needs of the ~omnid~ robot project.

* Main Features
0. Works on x86 Linux and tiva microcontrollers 
1. UART serial library with code to lower the default latency of FTDI USB to serial converters and to use RS-485 serial devices on linux.
   - Only some fixed baud rates are supported, but they are added on an as-needed basis 
   - It is also possible to set the default FTDI latency with udev rules
2. Lock-free single-producer single-consumer queue
3. CMake utilities
   - Exposing git information at compile time via generated header files
   - Compile flags that I like can (optionally) be carried over by linking with the library
     - Extra warnings, strict standard compliance, and modern C and C++ standards
   - Basic CMake options that I find useful
     - Prevent in-source builds
     - Set a default build type (for single-configuration generators)
       
4. Flexible error handling code.  Designed to immediately terminate program while preserving debugging information.
5. A PID controller implementation
6. Generic interface for doing math with multi-turn encoders
7. Static assertions for C code
8. Serialization library
9. Functions for handling time.
10. Red/Green/Blue LED control that convert to print statements on a host pc
11. Redistribute catch.hpp unit testing framework for use in other projects
* Installation
0. Install [[https://github.com/m-elwin/tiva-cmake][tiva-cmake]]
1. Clone the repository
   #+BEGIN_SRC bash
   git clone https://github.com/m-elwin/nuhal
   cd nuhal
   #+END_SRC
2. Build, install, and test the code for a given platform (in this case linux):
   #+BEGIN_SRC bash
   cmake -B nuhal_linux/build nuhal_linux
   cmake --build nuhal_linux/build
   cmake --build nuhal_linux/build --target test
   #+END_SRC
3. Repeat the above steps for each platform you wish to compile for
   - Each platform is named ~nuhal_<platform>~
   - ~nuhal_all~ is the core of the library and compiles on all platforms
   - ~nuhal_linux~ contains the linux-specific code
   - ~nuhal_tiva~ contains TI Tiva microcontroller code
* Usage
- Use ~find_package(nuhal)~ then add ~nuhal~ to the ~target_link_libraries~
  - This will auto-detect your platform based on the toolchain, host, and cross-compiling status
- If you would like to not add the default compile flags that ~nuhal~ uses,  use ~nuhal_noflags~ instead
- If you would like to link against a platform-specific version, use ~nuhal_<platform>~. Flags are not included
- If you would like to use just the flags, add ~nuhal_flags~ to ~target_link_libraries~

** Adding a Platform
1. Create a new subdirectory called ~nuhal_platform~
2. Use ~nuhal/nuhal_linux/CMakeLists.txt~ as a guide for the CMakeLists.txt file
3. If you need to support cross-compiling, use ~nuhal/nuhal_tiva/PreLoad.txt~ as a guide
   for setting a default cross compiler
4. Update ~/nuhal/nuhal_all/nuhal-config.cmake.in~ to make it aware of your new library.
   When a user does a ~find_package(nuhal)~ it is this file that is called and it is
   its responsibility to select the appropriate default ~nuhal~ library based on
   the platform and toolchain
   
